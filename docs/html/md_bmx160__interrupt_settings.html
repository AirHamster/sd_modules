<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SD_Modules: Steps to configure BMM150 Interrupts</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">SD_Modules
   &#160;<span id="projectnumber">1.0</span>
   </div>
   <div id="projectbrief">Code modules used in SailData firmwares</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('md_bmx160__interrupt_settings.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Steps to configure BMM150 Interrupts </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><ol type="1">
<li>Set the value of "desired_settings" from the list of macros from <b>TABLE 1.0-Macros for enabling the desired_settings</b> to enable the configuration of the selected settings. (Multiple settings can be set by bitwise OR-ing of the macros) &gt; Ex. desired_settings = BMM150_DRDY_PIN_EN_SEL | BMM150_DRDY_POLARITY_SEL;</li>
<li>Set the desired configuration in the dev structure using macros from the <b>TABLE 1.1-Interrupt configuration settings</b>. &gt; NOTE : Configuration settings will be set only when we set the corresponding "desired_settings" which enables the settings. <div class="fragment"><div class="line">/* Select the DRDY pin and polarity settings */</div>
<div class="line">desired_settings = BMM150_DRDY_PIN_EN_SEL | BMM150_DRDY_POLARITY_SEL;</div>
<div class="line">/* Set the desired configurations of DRDY pin and its polarity */</div>
<div class="line">dev-&gt;settings.int_settings.drdy_pin_en = BMM150_INT_ENABLE;</div>
<div class="line">dev-&gt;settings.int_settings.drdy_polarity = BMM150_ACTIVE_LOW_POLARITY;</div>
</div><!-- fragment --></li>
<li>Invoke the "bmm150_set_sensor_settings" API after setting the desired configuration in dev structure and enabling the corresponding "desired_settings" value,</li>
<li><p class="startli">Invoke the "bmm150_get_interrupt_status" API to get the interrupt status value in the dev-&gt;int_status.</p>
<p class="startli">The value of dev-&gt;int_status is taken and a bitwise AND operation is performed with predefined interrupt status macros (listed below) to find the interrupt status which is either set or reset.</p><ul>
<li>BMM150_LOW_THRESHOLD_INT_X</li>
<li>BMM150_LOW_THRESHOLD_INT_Y <br  />
</li>
<li>BMM150_LOW_THRESHOLD_INT_Z <br  />
</li>
<li>BMM150_HIGH_THRESHOLD_INT_X <br  />
</li>
<li>BMM150_HIGH_THRESHOLD_INT_Y <br  />
</li>
<li>BMM150_HIGH_THRESHOLD_INT_Z <br  />
</li>
<li>BMM150_DATA_OVERFLOW_INT <br  />
</li>
<li>BMM150_DATA_OVERRUN_INT <br  />
</li>
<li>BMM150_DATA_READY_INT <br  />
</li>
</ul>
</li>
</ol>
<div class="fragment"><div class="line">/* Example for checking interrupt status*/</div>
<div class="line">if (dev-&gt;int_status &amp; BMM150_DATA_READY_INT) {</div>
<div class="line">   /*Occurrence of data ready interrupt */</div>
<div class="line">   printf(&quot;\n Interrupt asserted&quot;);</div>
<div class="line">} else {</div>
<div class="line">   /* No interrupt occurred */</div>
<div class="line">   printf(&quot;\n Interrupt not asserted&quot;);</div>
<div class="line">}</div>
</div><!-- fragment --><blockquote class="doxtable">
<p>NOTE : The interrupt configuration settings which are set can be read from the sensor by invoking the "bmm150_get_sensor_settings" API. </p>
</blockquote>
<blockquote class="doxtable">
<p>NOTE : In BMM150 the interrupt pin INT is in default latched state and the polarity of INT and DRDY pins in default is active high. </p>
</blockquote>
<blockquote class="doxtable">
<p>NOTE : The macros mentioned below are present in the <a class="el" href="bmm150__defs_8h.html">bmm150_defs.h</a> file for setting the desired user configuration. </p>
</blockquote>
<h2><a class="anchor" id="autotoc_md6"></a>
TABLE 1.0-Macros for enabling the desired_settings</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Macros to set for "desired_settings" </th><th class="markdownTableHeadNone">Settings which can be enabled/Disabled  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">BMM150_DRDY_PIN_EN_SEL </td><td class="markdownTableBodyNone">Data ready interrupt mapping to DRDY PIN  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">BMM150_INT_PIN_EN_SEL </td><td class="markdownTableBodyNone">Low-Threshold, High-Threshold and Overflow interrupts mapping to INT PIN  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">BMM150_DRDY_POLARITY_SEL </td><td class="markdownTableBodyNone">Polarity of DRDY pin  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">BMM150_INT_LATCH_SEL </td><td class="markdownTableBodyNone">Latch settings of INT pin  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">BMM150_INT_POLARITY_SEL </td><td class="markdownTableBodyNone">Polarity of INT pin  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">BMM150_DATA_OVERRUN_INT_SEL </td><td class="markdownTableBodyNone">Data overrun interrupt setting  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">BMM150_OVERFLOW_INT_SEL </td><td class="markdownTableBodyNone">Data overflow interrupt setting  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">BMM150_HIGH_THRESHOLD_INT_SEL </td><td class="markdownTableBodyNone">High threshold interrupt setting  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">BMM150_LOW_THRESHOLD_INT_SEL </td><td class="markdownTableBodyNone">Low threshold interrupt setting  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">BMM150_LOW_THRESHOLD_SETTING_SEL </td><td class="markdownTableBodyNone">Setting Low threshold value to trigger interrupt  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">BMM150_HIGH_THRESHOLD_SETTING_SEL </td><td class="markdownTableBodyNone">Setting High threshold value to trigger interrupt  </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md7"></a>
TABLE 1.1-Interrupt configuation settings</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">User configration in the dev structure </th><th class="markdownTableHeadNone">Macros which can be assigned </th><th class="markdownTableHeadNone">Significance  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone" rowspan="2">dev-&gt;settings.int_settings.drdy_pin_en </td><td class="markdownTableBodyNone">BMM150_INT_ENABLE </td><td class="markdownTableBodyNone">Maps the data ready interrupt to the DRDY pin of sensor  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">BMM150_INT_DISABLE </td><td class="markdownTableBodyNone">Disables the mapping of data ready interrupt signal to the DRDY pin  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone" colspan="3"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone" rowspan="2">dev-&gt;settings.int_settings.int_pin_en </td><td class="markdownTableBodyNone">BMM150_INT_ENABLE </td><td class="markdownTableBodyNone">Enables the mapping of Low-Threshold, High-Threshold and Overflow interrupts to INT (interrupt) pin  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">BMM150_INT_DISABLE </td><td class="markdownTableBodyNone">Disables the interrupt mapping to the INT pin  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone" colspan="3"></td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone" rowspan="2">dev-&gt;settings.int_settings.drdy_polarity </td><td class="markdownTableBodyNone">BMM150_ACTIVE_HIGH_POLARITY </td><td class="markdownTableBodyNone">Sets the interrupt signal polarity in DRDY pin as active high  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">BMM150_ACTIVE_LOW_POLARITY </td><td class="markdownTableBodyNone">Sets the interrupt signal polarity in DRDY pin as active low  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone" colspan="3"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone" rowspan="2">dev-&gt;settings.int_settings.int_polarity </td><td class="markdownTableBodyNone">BMM150_ACTIVE_HIGH_POLARITY </td><td class="markdownTableBodyNone">Sets the interrupt signal polarity in INT pin as active high  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">BMM150_ACTIVE_LOW_POLARITY </td><td class="markdownTableBodyNone">Sets the interrupt signal polarity in INT pin as active low  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone" colspan="3"></td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone" rowspan="2">dev-&gt;settings.int_settings.int_latch </td><td class="markdownTableBodyNone">BMM150_LATCHED </td><td class="markdownTableBodyNone">Sets the interrupt signal in INT pin in latched mode  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">BMM150_NON_LATCHED </td><td class="markdownTableBodyNone">Sets the interrupt signal in INT pin in non - latched mode  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone" colspan="3"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone" rowspan="2">dev-&gt;settings.int_settings.data_overrun_en </td><td class="markdownTableBodyNone">BMM150_INT_ENABLE </td><td class="markdownTableBodyNone">Enables the data overrun interrupt  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">BMM150_INT_DISABLE </td><td class="markdownTableBodyNone">Disables the data overrun interrupt  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone" colspan="3"></td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone" rowspan="2">dev-&gt;settings.int_settings.overflow_int_en </td><td class="markdownTableBodyNone">BMM150_INT_ENABLE </td><td class="markdownTableBodyNone">Enables the overflow interrupt  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">BMM150_INT_DISABLE </td><td class="markdownTableBodyNone">Disables the overflow interrupt  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone" colspan="3"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">dev-&gt;settings.int_settings.high_int_en </td><td class="markdownTableBodyNone">BMM150_THRESHOLD_X </td><td class="markdownTableBodyNone">Enables the threshold interrupt detection for X axis  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone" rowspan="4">dev-&gt;settings.int_settings.high_int_en </td><td class="markdownTableBodyNone">BMM150_THRESHOLD_Y </td><td class="markdownTableBodyNone">Enables the threshold interrupt detection for Y axis  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">BMM150_THRESHOLD_Z </td><td class="markdownTableBodyNone">Enables the threshold interrupt detection for Z axis  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">(BMM150_THRESHOLD_X &amp; BMM150_THRESHOLD_Y) </td><td class="markdownTableBodyNone">Enables the threshold interrupt detection for x,y axes  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">(BMM150_THRESHOLD_X &amp; BMM150_THRESHOLD_Y &amp; BMM150_THRESHOLD_Z) </td><td class="markdownTableBodyNone">Enables the threshold interrupt interrupt detection for all 3 X,Y and Z axes  </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md8"></a>
Configuring and handling BMM150 Interrupts</h2>
<h3><a class="anchor" id="autotoc_md9"></a>
Example for using high threshold interrupt</h3>
<blockquote class="doxtable">
<p>Configuring the high threshold interrupt </p>
</blockquote>
<div class="fragment"><div class="line">int8_t high_threshold_interrupt(struct bmm150_dev *dev)</div>
<div class="line">{</div>
<div class="line">    int8_t rslt;</div>
<div class="line">    uint16_t desired_settings;</div>
<div class="line"> </div>
<div class="line">    /* Enable the desired settings to be set in the sensor */</div>
<div class="line">    desired_settings = BMM150_HIGH_THRESHOLD_INT_SEL | BMM150_HIGH_THRESHOLD_SETTING_SEL |</div>
<div class="line">        BMM150_INT_PIN_EN_SEL | BMM150_INT_POLARITY_SEL | BMM150_INT_LATCH_SEL;</div>
<div class="line">    </div>
<div class="line">    /* Set the desired configuration */</div>
<div class="line">    /* Enable the mapping of interrupt to the interrupt pin*/</div>
<div class="line">    dev-&gt;settings.int_settings.int_pin_en = BMM150_INT_ENABLE;</div>
<div class="line">    /* Set the interrupt in non latched mode */</div>
<div class="line">    dev-&gt;settings.int_settings.int_latch = BMM150_NON_LATCHED;</div>
<div class="line">    /* Set the interrupt polarity as active high */</div>
<div class="line">    dev-&gt;settings.int_settings.int_polarity = BMM150_ACTIVE_HIGH_POLARITY;</div>
<div class="line">    /* Set the threshold value as 0x0A (10*6 = 60 micro-tesla)*/</div>
<div class="line">    dev-&gt;settings.int_settings.high_threshold = 0x0A;</div>
<div class="line">    /* Set the high threshold detection for all 3 axis */</div>
<div class="line">    dev-&gt;settings.int_settings.high_int_en = BMM150_THRESHOLD_X &amp; BMM150_THRESHOLD_Y &amp; BMM150_THRESHOLD_Z;</div>
<div class="line">    </div>
<div class="line">    /* Set the configurations in the sensor */</div>
<div class="line">    rslt = bmm150_set_sensor_settings(desired_settings, dev);</div>
<div class="line">    </div>
<div class="line">    return rslt;</div>
<div class="line">}</div>
</div><!-- fragment --><blockquote class="doxtable">
<p>Read the interrupt status continuously to check for interrupt assertion (Polling method) </p>
</blockquote>
<div class="fragment"><div class="line">int8_t high_threshold_interrupt_handling(struct bmm150_dev *dev)</div>
<div class="line">{</div>
<div class="line">    int8_t rslt;</div>
<div class="line">    </div>
<div class="line">    rslt = bmm150_get_interrupt_status(dev);</div>
<div class="line">    if (rslt == BMM150_OK) {</div>
<div class="line">        if (dev-&gt;int_status &amp; BMM150_HIGH_THRESHOLD_INT_X) {</div>
<div class="line">            printf(&quot;\n HIGH THRESHOLD INTERRUPT ON X AXIS &quot;);</div>
<div class="line">        }</div>
<div class="line">        if (dev-&gt;int_status &amp; BMM150_HIGH_THRESHOLD_INT_Y) {</div>
<div class="line">            printf(&quot;\n HIGH THRESHOLD INTERRUPT ON Y AXIS &quot;);</div>
<div class="line">        }</div>
<div class="line">        if(dev-&gt;int_status &amp; BMM150_HIGH_THRESHOLD_INT_Z) {</div>
<div class="line">            printf(&quot;\n HIGH THRESHOLD INTERRUPT IN Z AXIS &quot;);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    return rslt;</div>
<div class="line">}</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md10"></a>
Example for using multiple interrupts (data ready and overflow interrupts)</h3>
<blockquote class="doxtable">
<p>Configuring the overflow and data ready interrupts and interrupt pins and latch settings </p>
</blockquote>
<div class="fragment"><div class="line">int8_t drdy_overflow_int_setting(struct bmm150_dev *dev)</div>
<div class="line">{</div>
<div class="line">    int8_t rslt;</div>
<div class="line">    uint16_t desired_settings;</div>
<div class="line"> </div>
<div class="line">    /* Enable the desired settings to be set in the sensor */</div>
<div class="line">    desired_settings = BMM150_DRDY_PIN_EN_SEL | BMM150_OVERFLOW_INT_SEL |</div>
<div class="line">        BMM150_INT_PIN_EN_SEL | BMM150_INT_LATCH_SEL;</div>
<div class="line">    </div>
<div class="line">    /* Set the desired configuration */</div>
<div class="line">    /* Enable the drdy interrupt  */</div>
<div class="line">    dev-&gt;settings.int_settings.drdy_pin_en = BMM150_INT_ENABLE;</div>
<div class="line">    /* Enable the mapping of interrupt to the interrupt pin */</div>
<div class="line">    dev-&gt;settings.int_settings.int_pin_en = BMM150_INT_ENABLE;</div>
<div class="line">    /* Enable the overflow interrupt */</div>
<div class="line">    dev-&gt;settings.int_settings.overflow_int_en = BMM150_INT_ENABLE;</div>
<div class="line">    /* Set the interrupt in non latched mode */</div>
<div class="line">    dev-&gt;settings.int_settings.int_latch = BMM150_NON_LATCHED;</div>
<div class="line"> </div>
<div class="line">    /* Set the configurations in the sensor */</div>
<div class="line">    rslt = bmm150_set_sensor_settings(desired_settings, dev);</div>
<div class="line">    </div>
<div class="line">}</div>
</div><!-- fragment --><blockquote class="doxtable">
<p>Read the interrupt status continuously to check for interrupt assertion (Polling method) </p>
</blockquote>
<div class="fragment"><div class="line">int8_t drdy_overflow_int_handling(struct bmm150_dev *dev)</div>
<div class="line">{</div>
<div class="line">    int8_t rslt;</div>
<div class="line"> </div>
<div class="line">    rslt = bmm150_get_interrupt_status(dev);</div>
<div class="line">    if (rslt == BMM150_OK) {</div>
<div class="line">        /* Multiple interrupt assertion can be checked as follows */</div>
<div class="line">        if ((dev-&gt;int_status &amp; BMM150_DATA_READY_INT) ||</div>
<div class="line">            (dev-&gt;int_status &amp; BMM150_DATA_OVERFLOW_INT)) {</div>
<div class="line">            /* Either data ready or overflow has occurred */</div>
<div class="line">            printf(&quot;\n Interrupt asserted &quot;);</div>
<div class="line">        } else {</div>
<div class="line">            printf(&quot;\n Interrupt not asserted &quot;);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    return rslt;</div>
<div class="line">}</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
