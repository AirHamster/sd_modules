<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SD_Modules: MCU-MCU Communication Driver</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">SD_Modules
   &#160;<span id="projectnumber">1.0</span>
   </div>
   <div id="projectbrief">Code modules used in SailData firmwares</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('group___m_c_u-_m_c_u.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#enum-members">Enumerations</a> &#124;
<a href="#enumval-members">Enumerator</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">MCU-MCU Communication Driver</div>  </div>
</div><!--header-->
<div class="contents">

<p>Multi MCU communication driver.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structmcu__mcu__data__t.html">mcu_mcu_data_t</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Battery data.  <a href="structmcu__mcu__data__t.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structpower__data__t.html">power_data_t</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Power data.  <a href="structpower__data__t.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:gac20ddaf5e602274798df8c0e82949c9c"><td class="memItemLeft" align="right" valign="top"><a id="gac20ddaf5e602274798df8c0e82949c9c"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>SD_MODULES_MCU</b>&#160;&#160;&#160;-MCU_H_</td></tr>
<tr class="separator:gac20ddaf5e602274798df8c0e82949c9c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga6b3f5112ea765e9ae56b0df53849f153"><td class="memItemLeft" align="right" valign="top"><a id="ga6b3f5112ea765e9ae56b0df53849f153"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>MCU_MCU_SLAVE_ADDR</b>&#160;&#160;&#160;0x10</td></tr>
<tr class="separator:ga6b3f5112ea765e9ae56b0df53849f153"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="enum-members"></a>
Enumerations</h2></td></tr>
<tr class="memitem:gae98cbecd8a7f828dfebe8aa70c40e4fc"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___m_c_u-_m_c_u.html#gae98cbecd8a7f828dfebe8aa70c40e4fc">msg_reason_enum</a> { <br />
&#160;&#160;<a class="el" href="group___m_c_u-_m_c_u.html#ggae98cbecd8a7f828dfebe8aa70c40e4fca29881aa2e4e66f1bd5c114f9eaf66e1e">STARTUP_NORMAL</a> = 0, 
<a class="el" href="group___m_c_u-_m_c_u.html#ggae98cbecd8a7f828dfebe8aa70c40e4fcad0d0a3fb3e195e6ce678788735056f2a">STARTUP_CHARGE</a>, 
<a class="el" href="group___m_c_u-_m_c_u.html#ggae98cbecd8a7f828dfebe8aa70c40e4fca89f464d9f8b686f5cb9af663c6bcf83e">STARTUP_BAT_LOW</a>, 
<a class="el" href="group___m_c_u-_m_c_u.html#ggae98cbecd8a7f828dfebe8aa70c40e4fca7690b021f467450541d8d89123429d40">SHUTDOWN</a>, 
<br />
&#160;&#160;<a class="el" href="group___m_c_u-_m_c_u.html#ggae98cbecd8a7f828dfebe8aa70c40e4fca9d7d6f31868d66330397c967c4afd2d2">DATA</a>, 
<a class="el" href="group___m_c_u-_m_c_u.html#ggae98cbecd8a7f828dfebe8aa70c40e4fca2da84e4fb999951754c859d16c69b145">KEY_PRESS</a>
<br />
 }</td></tr>
<tr class="memdesc:gae98cbecd8a7f828dfebe8aa70c40e4fc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Messages to slave MCU.  <a href="group___m_c_u-_m_c_u.html#gae98cbecd8a7f828dfebe8aa70c40e4fc">More...</a><br /></td></tr>
<tr class="separator:gae98cbecd8a7f828dfebe8aa70c40e4fc"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:gae5e6b0bada4970a59425be1d2723f518"><td class="memItemLeft" align="right" valign="top">static&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___m_c_u-_m_c_u.html#gae5e6b0bada4970a59425be1d2723f518">THD_WORKING_AREA</a> (mcu_mcu_thread_wa, 256)</td></tr>
<tr class="separator:gae5e6b0bada4970a59425be1d2723f518"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaa87ad5fa78aa8004f9b23777ff56bf21"><td class="memItemLeft" align="right" valign="top"><a id="gaa87ad5fa78aa8004f9b23777ff56bf21"></a>
static&#160;</td><td class="memItemRight" valign="bottom"><b>THD_FUNCTION</b> (mcu_mcu_thread, p)</td></tr>
<tr class="separator:gaa87ad5fa78aa8004f9b23777ff56bf21"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga2348fa0c23cb3be4328f84f75f4f80aa"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___m_c_u-_m_c_u.html#ga2348fa0c23cb3be4328f84f75f4f80aa">start_mcu_mcu_module</a> (void)</td></tr>
<tr class="separator:ga2348fa0c23cb3be4328f84f75f4f80aa"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:ga42b262329a1037a58d4e9ecd38c46eb0"><td class="memItemLeft" align="right" valign="top"><a id="ga42b262329a1037a58d4e9ecd38c46eb0"></a>
volatile int8_t&#160;</td><td class="memItemRight" valign="bottom"><b>buffer</b> [32] = {0}</td></tr>
<tr class="separator:ga42b262329a1037a58d4e9ecd38c46eb0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga80d6ac737d28f19d8324e5689651f793"><td class="memItemLeft" align="right" valign="top"><a id="ga80d6ac737d28f19d8324e5689651f793"></a>
<a class="el" href="structmcu__mcu__data__t.html">mcu_mcu_data_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><b>mcu_mcu_data</b></td></tr>
<tr class="separator:ga80d6ac737d28f19d8324e5689651f793"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga4537bef23336cbd662e2749dc789c371"><td class="memItemLeft" align="right" valign="top"><a id="ga4537bef23336cbd662e2749dc789c371"></a>
<a class="el" href="structpower__data__t.html">power_data_t</a>&#160;</td><td class="memItemRight" valign="bottom"><b>power</b></td></tr>
<tr class="separator:ga4537bef23336cbd662e2749dc789c371"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gabbe1c18a1379e6c117b2b07222397866"><td class="memItemLeft" align="right" valign="top"><a id="gabbe1c18a1379e6c117b2b07222397866"></a>
<a class="el" href="structpower__data__t.html">power_data_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><b>power_data</b> = &amp;power</td></tr>
<tr class="separator:gabbe1c18a1379e6c117b2b07222397866"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga384618f0b35f432a3477616ccf570d2f"><td class="memItemLeft" align="right" valign="top"><a id="ga384618f0b35f432a3477616ccf570d2f"></a>
int16_t&#160;</td><td class="memItemRight" valign="bottom"><b>voltage</b></td></tr>
<tr class="separator:ga384618f0b35f432a3477616ccf570d2f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga28932f292e470c3f98a0a9f4fc43b2b2"><td class="memItemLeft" align="right" valign="top"><a id="ga28932f292e470c3f98a0a9f4fc43b2b2"></a>
int16_t&#160;</td><td class="memItemRight" valign="bottom"><b>current</b></td></tr>
<tr class="separator:ga28932f292e470c3f98a0a9f4fc43b2b2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gab4e3dbd3f4368fe16592a0fdd8cb665e"><td class="memItemLeft" align="right" valign="top"><a id="gab4e3dbd3f4368fe16592a0fdd8cb665e"></a>
int16_t&#160;</td><td class="memItemRight" valign="bottom"><b>soc</b></td></tr>
<tr class="separator:gab4e3dbd3f4368fe16592a0fdd8cb665e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gafb6907d7dc2dc7a6be48c6a8086244be"><td class="memItemLeft" align="right" valign="top"><a id="gafb6907d7dc2dc7a6be48c6a8086244be"></a>
int16_t&#160;</td><td class="memItemRight" valign="bottom"><b>capacity</b></td></tr>
<tr class="separator:gafb6907d7dc2dc7a6be48c6a8086244be"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga28932f292e470c3f98a0a9f4fc43b2b2"><td class="memItemLeft" align="right" valign="top"><a id="ga28932f292e470c3f98a0a9f4fc43b2b2"></a>
int16_t&#160;</td><td class="memItemRight" valign="bottom"><b>current</b></td></tr>
<tr class="separator:ga28932f292e470c3f98a0a9f4fc43b2b2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga384618f0b35f432a3477616ccf570d2f"><td class="memItemLeft" align="right" valign="top"><a id="ga384618f0b35f432a3477616ccf570d2f"></a>
int16_t&#160;</td><td class="memItemRight" valign="bottom"><b>voltage</b></td></tr>
<tr class="separator:ga384618f0b35f432a3477616ccf570d2f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaaa07c1a9fb17f64dd4bbc5f14a0c48a8"><td class="memItemLeft" align="right" valign="top"><a id="gaaa07c1a9fb17f64dd4bbc5f14a0c48a8"></a>
int8_t&#160;</td><td class="memItemRight" valign="bottom"><b>soc</b></td></tr>
<tr class="separator:gaaa07c1a9fb17f64dd4bbc5f14a0c48a8"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>Multi MCU communication driver. </p>
<p>Detail will be writen soon </p><dl class="section pre"><dt>Precondition</dt><dd>In order to use the ICU driver the <code>USE_MCU_MCU_MODULE</code> option must be enabled in <code>config.h</code>.</dd></dl>
<h1><a class="anchor" id="mcu_mcu_1"></a>
Driver State Machine</h1>
<p>The driver implements a state machine internally, not all the driver functionalities can be used in any moment, any transition not explicitly shown in the following diagram has to be considered an error and shall be captured by an assertion (if enabled). </p><div class="dotgraph">
<img src="dot_inline_dotgraph_8.png" alt="dot_inline_dotgraph_8.png" border="0" usemap="#dot_inline_dotgraph_8.map"/>
</div>
<h1><a class="anchor" id="mcu_mcu_2"></a>
MCU_MCU operations.</h1>
<p>This driver abstracts a generic Input Capture Unit composed of:</p><ul>
<li>A clock prescaler.</li>
<li>A main up counter.</li>
<li>Two capture registers triggered by the rising and falling edges on the sampled input.</li>
</ul>
<p>The ICU unit can be programmed to synchronize on the rising or falling edge of the sample input:</p><ul>
<li><b>ICU_INPUT_ACTIVE_HIGH</b>, a rising edge is the start signal.</li>
<li><b>ICU_INPUT_ACTIVE_LOW</b>, a falling edge is the start signal.</li>
</ul>
<p>Callbacks are optionally invoked when:</p><ul>
<li>On the PWM de-activation edge.</li>
<li>On the PWM activation edge, measurements for the previous cycle are available from this callback and can be retrieved using <code>icuGetPeriodX()</code> and <code>icuGetWidthX()</code>.</li>
</ul>
<h2 class="groupheader">Enumeration Type Documentation</h2>
<a id="gae98cbecd8a7f828dfebe8aa70c40e4fc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gae98cbecd8a7f828dfebe8aa70c40e4fc">&#9670;&nbsp;</a></span>msg_reason_enum</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="group___m_c_u-_m_c_u.html#gae98cbecd8a7f828dfebe8aa70c40e4fc">msg_reason_enum</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Messages to slave MCU. </p>
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a id="ggae98cbecd8a7f828dfebe8aa70c40e4fca29881aa2e4e66f1bd5c114f9eaf66e1e"></a>STARTUP_NORMAL&#160;</td><td class="fielddoc"><p>STARTUP_NORMAL. </p>
</td></tr>
<tr><td class="fieldname"><a id="ggae98cbecd8a7f828dfebe8aa70c40e4fcad0d0a3fb3e195e6ce678788735056f2a"></a>STARTUP_CHARGE&#160;</td><td class="fielddoc"><p>STARTUP_CHARGE. </p>
</td></tr>
<tr><td class="fieldname"><a id="ggae98cbecd8a7f828dfebe8aa70c40e4fca89f464d9f8b686f5cb9af663c6bcf83e"></a>STARTUP_BAT_LOW&#160;</td><td class="fielddoc"><p>STARTUP_BAT_LOW. </p>
</td></tr>
<tr><td class="fieldname"><a id="ggae98cbecd8a7f828dfebe8aa70c40e4fca7690b021f467450541d8d89123429d40"></a>SHUTDOWN&#160;</td><td class="fielddoc"><p>SHUTDOWN. </p>
</td></tr>
<tr><td class="fieldname"><a id="ggae98cbecd8a7f828dfebe8aa70c40e4fca9d7d6f31868d66330397c967c4afd2d2"></a>DATA&#160;</td><td class="fielddoc"><p>DATA. </p>
</td></tr>
<tr><td class="fieldname"><a id="ggae98cbecd8a7f828dfebe8aa70c40e4fca2da84e4fb999951754c859d16c69b145"></a>KEY_PRESS&#160;</td><td class="fielddoc"><p>KEY_PRESS. </p>
</td></tr>
</table>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="ga2348fa0c23cb3be4328f84f75f4f80aa"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga2348fa0c23cb3be4328f84f75f4f80aa">&#9670;&nbsp;</a></span>start_mcu_mcu_module()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void start_mcu_mcu_module </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Start communication threads </p>

</div>
</div>
<a id="gae5e6b0bada4970a59425be1d2723f518"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gae5e6b0bada4970a59425be1d2723f518">&#9670;&nbsp;</a></span>THD_WORKING_AREA()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static THD_WORKING_AREA </td>
          <td>(</td>
          <td class="paramtype">mcu_mcu_thread_wa&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">256&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Main communication thread </p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
