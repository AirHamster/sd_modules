<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SD_Modules: USB Driver</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">SD_Modules
   &#160;<span id="projectnumber">1.0</span>
   </div>
   <div id="projectbrief">Code modules used in SailData firmwares</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('group___u_s_b.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">USB Driver<div class="ingroups"><a class="el" href="group___i_o.html">Generic</a> &raquo; <a class="el" href="group___h_a_l___n_o_r_m_a_l___d_r_i_v_e_r_s.html">Normal Drivers</a></div></div>  </div>
</div><!--header-->
<div class="contents">

<p>Generic USB Driver.  
<a href="#details">More...</a></p>
<div class="dynheader">
Collaboration diagram for USB Driver:</div>
<div class="dyncontent">
<div class="center"><img src="group___u_s_b.png" border="0" usemap="#group______u__s__b" alt=""/></div>
<map name="group______u__s__b" id="group______u__s__b">
<area shape="rect" href="group___h_a_l___n_o_r_m_a_l___d_r_i_v_e_r_s.html" title="HAL Normal Drivers." alt="" coords="5,5,116,31"/>
<area shape="rect" title="Generic USB Driver." alt="" coords="164,5,253,31"/>
</map>
</div>
<p>Generic USB Driver. </p>
<p>This module implements a generic USB (Universal Serial Bus) driver supporting device-mode operations. </p><dl class="section pre"><dt>Precondition</dt><dd>In order to use the USB driver the <code>HAL_USE_USB</code> option must be enabled in <code>halconf.h</code>.</dd></dl>
<h1><a class="anchor" id="usb_1"></a>
Driver State Machine</h1>
<p>The driver implements a state machine internally, not all the driver functionalities can be used in any moment, any transition not explicitly shown in the following diagram has to be considered an error and shall be captured by an assertion (if enabled). </p><div class="dotgraph">
<img src="dot_inline_dotgraph_16.png" alt="dot_inline_dotgraph_16.png" border="0" usemap="#dot_inline_dotgraph_16.map"/>
</div>
<h1><a class="anchor" id="usb_2"></a>
USB Operations</h1>
<p>The USB driver is quite complex and USB is complex in itself, it is recommended to study the USB specification before trying to use the driver.</p>
<h2><a class="anchor" id="usb_2_1"></a>
USB Implementation</h2>
<p>The USB driver abstracts the inner details of the underlying USB hardware. The driver works asynchronously and communicates with the application using callbacks. The application is responsible of the descriptors and strings required by the USB device class to be implemented and of the handling of the specific messages sent over the endpoint zero. Standard messages are handled internally to the driver. The application can use hooks in order to handle custom messages or override the handling of the default handling of standard messages.</p>
<h2><a class="anchor" id="usb_2_2"></a>
USB Endpoints</h2>
<p>USB endpoints are the objects that the application uses to exchange data with the host. There are two kind of endpoints:</p><ul>
<li><b>IN</b> endpoints are used by the application to transmit data to the host.<br  />
</li>
<li><b>OUT</b> endpoints are used by the application to receive data from the host.</li>
</ul>
<p>The driver invokes a callback after finishing an IN or OUT transaction. States diagram for OUT endpoints in transaction mode: </p><div class="dotgraph">
<img src="dot_inline_dotgraph_17.png" alt="dot_inline_dotgraph_17.png" border="0" usemap="#dot_inline_dotgraph_17.map"/>
</div>
<p> <br  />
<br  />
 States diagram for IN endpoints in transaction mode: </p><div class="dotgraph">
<img src="dot_inline_dotgraph_18.png" alt="dot_inline_dotgraph_18.png" border="0" usemap="#dot_inline_dotgraph_18.map"/>
</div>
<p> <br  />
<br  />
</p>
<h2><a class="anchor" id="usb_2_4"></a>
USB Callbacks</h2>
<p>The USB driver uses callbacks in order to interact with the application. There are several kinds of callbacks to be handled:</p><ul>
<li>Driver events callback. As example errors, suspend event, reset event etc.</li>
<li>Messages Hook callback. This hook allows the application to implement handling of custom messages or to override the default handling of standard messages on endpoint zero.</li>
<li>Descriptor Requested callback. When the driver endpoint zero handler receives a GET DESCRIPTOR message and needs to send a descriptor to the host it queries the application using this callback.</li>
<li>Start of Frame callback. This callback is invoked each time a SOF packet is received.</li>
<li>Endpoint callbacks. Each endpoint informs the application about I/O conditions using those callbacks.</li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
