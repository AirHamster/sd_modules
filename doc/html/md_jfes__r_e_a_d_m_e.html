<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SD_Modules: JFES</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">SD_Modules
   &#160;<span id="projectnumber">1.0</span>
   </div>
   <div id="projectbrief">Code modules used in SailData firmwares</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('md_jfes__r_e_a_d_m_e.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">JFES </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><em>Based on the <a href="https://github.com/zserge/jsmn">jsmn</a> project.</em></p>
<p>Json For Embedded Systems (JFES) is a minimalistic <a href="http://www.json.org/">json</a> engine written in plain C. It can be easily integrated into the code for embedded systems.</p>
<h1><a class="anchor" id="autotoc_md465"></a>
Features</h1>
<ul>
<li>compatible with C99</li>
<li>no dependencies (I'm serious!)</li>
<li>highly portable</li>
<li>you can use it as a json parser only</li>
<li>incremental single-pass parsing</li>
</ul>
<h1><a class="anchor" id="autotoc_md466"></a>
API</h1>
<h2><a class="anchor" id="autotoc_md467"></a>
Initializing</h2>
<p>Before use you need to initialize the <code>jfes_config_t</code> object. </p><div class="fragment"><div class="line">/** JFES config structure. */</div>
<div class="line">typedef struct jfes_config {</div>
<div class="line">    jfes_malloc_t           jfes_malloc;        /**&lt; Memory allocation function. */</div>
<div class="line">    jfes_free_t             jfes_free;          /**&lt; Memory deallocation function. */</div>
<div class="line">} jfes_config_t;</div>
</div><!-- fragment --><p>Below you can see the prototypes of the memory management functions: </p><div class="fragment"><div class="line">/** Memory allocator function type. */</div>
<div class="line">typedef void *(__cdecl *jfes_malloc_t)(jfes_size_t);</div>
<div class="line"> </div>
<div class="line">/** Memory deallocator function type. */</div>
<div class="line">typedef void (__cdecl *jfes_free_t)(void*);</div>
</div><!-- fragment --><p>As you can see, these functions have the same prototype as the C standard library functions.</p>
<p>So, you can initialize JFES configuration with the following code: </p><div class="fragment"><div class="line">#include &lt;stdlib.h&gt;</div>
<div class="line"> </div>
<div class="line">/* ...some useful stuff... */</div>
<div class="line"> </div>
<div class="line">jfes_config_t config;</div>
<div class="line"> </div>
<div class="line">config.jfes_malloc = malloc;</div>
<div class="line">config.jfes_free = free;</div>
</div><!-- fragment --><p>But, if you need to use your own memory management functions, you can use them.</p>
<h2><a class="anchor" id="autotoc_md468"></a>
Parser (optional)</h2>
<p>If you just need to parse a *.json file without allocating any values (like <a href="https://github.com/zserge/jsmn">jsmn</a>), you can parse a json string and separate it into tokens. In this case, you only need to use two functions below: </p><div class="fragment"><div class="line">/**</div>
<div class="line">    JFES parser initialization.</div>
<div class="line">    \param[out]     parser              Pointer to the jfes_parser_t object.</div>
<div class="line">    \param[in]      config              JFES configuration.</div>
<div class="line">    \return         jfes_success if everything is OK.</div>
<div class="line">*/</div>
<div class="line">jfes_status_t jfes_init_parser(jfes_parser_t *parser, jfes_config_t *config);</div>
<div class="line"> </div>
<div class="line">/******************************************************************/</div>
<div class="line"> </div>
<div class="line">/**</div>
<div class="line">    Run JSON parser. It parses a JSON data string into and</div>
<div class="line">    array of tokens, each describing a single JSON object.</div>
<div class="line">    \param[in]      parser              Pointer to the jfes_parser_t object.</div>
<div class="line">    \param[in]      json                JSON data string.</div>
<div class="line">    \param[in]      length              JSON data length.</div>
<div class="line">    \param[out]     tokens              Tokens array to fill.</div>
<div class="line">    \param[in, out] max_tokens_count    Maximal count of tokens in tokens array.</div>
<div class="line">                                        Will contain tokens count.</div>
<div class="line">    \return         jfes_success if everything is OK.</div>
<div class="line">*/</div>
<div class="line">jfes_status_t jfes_parse_tokens(jfes_parser_t *parser, const char *json,</div>
<div class="line">    jfes_size_t length, jfes_token_t *tokens, jfes_size_t *max_tokens_count);</div>
</div><!-- fragment --><p>You can see a parsing example below.</p>
<h2><a class="anchor" id="autotoc_md469"></a>
Loading *.json into value</h2>
<p>You can load any json data into <code>jfes_value_t</code>.</p>
<div class="fragment"><div class="line">/** JSON value structure. */</div>
<div class="line">struct jfes_value {</div>
<div class="line">    jfes_value_type_t       type;               /**&lt; JSON value type. */</div>
<div class="line">    jfes_value_data_t       data;               /**&lt; Value data. */</div>
<div class="line">};</div>
</div><!-- fragment --><p>Value type (<code>jfes_value_type_t</code>) can be one of the following:</p><ul>
<li><code>jfes_type_boolean</code></li>
<li><code>jfes_type_integer</code></li>
<li><code>jfes_type_double</code></li>
<li><code>jfes_type_string</code></li>
<li><code>jfes_type_array</code></li>
<li><code>jfes_type_object</code></li>
</ul>
<p>And <code>jfes_value_data_t</code> is: </p><div class="fragment"><div class="line">/** JFES value data union. */</div>
<div class="line">typedef union jfes_value_data {</div>
<div class="line">    int                     bool_val;           /**&lt; Boolean JSON value. */</div>
<div class="line"> </div>
<div class="line">    int                     int_val;            /**&lt; Integer JSON value. */</div>
<div class="line">    double                  double_val;         /**&lt; Double JSON value. */</div>
<div class="line">    jfes_string_t           string_val;         /**&lt; String JSON value. */</div>
<div class="line"> </div>
<div class="line">    jfes_array_t            *array_val;         /**&lt; Array JSON value. */</div>
<div class="line">    jfes_object_t           *object_val;        /**&lt; Object JSON value. */</div>
<div class="line">} jfes_value_data_t;</div>
</div><!-- fragment --><p>You can easily load a json string into the value by using the following code: </p><div class="fragment"><div class="line">jfes_config_t config;</div>
<div class="line">config.jfes_malloc = malloc;</div>
<div class="line">config.jfes_free = free;</div>
<div class="line"> </div>
<div class="line">jfes_value_t value;</div>
<div class="line">jfes_parse_to_value(&amp;config, json_data, json_size, &amp;value);</div>
<div class="line">/* Do something with value */</div>
<div class="line">jfes_free_value(&amp;config, &amp;value);</div>
</div><!-- fragment --><p>That's all!</p>
<h2><a class="anchor" id="autotoc_md470"></a>
Value modification</h2>
<p>You can modify or create <code>jfes_value_t</code> with any of these functions: </p><div class="fragment"><div class="line">jfes_value_t *jfes_create_boolean_value(jfes_config_t *config, int value);</div>
<div class="line">jfes_value_t *jfes_create_integer_value(jfes_config_t *config, int value);</div>
<div class="line">jfes_value_t *jfes_create_double_value(jfes_config_t *config, double value);</div>
<div class="line">jfes_value_t *jfes_create_string_value(jfes_config_t *config, const char *value, jfes_size_t length);</div>
<div class="line">jfes_value_t *jfes_create_array_value(jfes_config_t *config);</div>
<div class="line">jfes_value_t *jfes_create_object_value(jfes_config_t *config);</div>
<div class="line"> </div>
<div class="line">jfes_value_t *jfes_get_child(jfes_value_t *value, const char *key, jfes_size_t key_length);</div>
<div class="line">jfes_object_map_t *jfes_get_mapped_child(jfes_value_t *value, const char *key, jfes_size_t key_length);</div>
<div class="line"> </div>
<div class="line">jfes_status_t jfes_place_to_array(jfes_config_t *config, jfes_value_t *value, jfes_value_t *item);</div>
<div class="line">jfes_status_t jfes_place_to_array_at(jfes_config_t *config, jfes_value_t *value, jfes_value_t *item, jfes_size_t place_at);</div>
<div class="line">jfes_status_t jfes_remove_from_array(jfes_config_t *config, jfes_value_t *value, jfes_size_t index);</div>
<div class="line"> </div>
<div class="line">jfes_status_t jfes_set_object_property(jfes_config_t *config, jfes_value_t *value, jfes_value_t *item, const char *key, jfes_size_t key_length);</div>
<div class="line">jfes_status_t jfes_remove_object_property(jfes_config_t *config, jfes_value_t *value, const char *key, jfes_size_t key_length);</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md471"></a>
Serializing to json string</h2>
<p>You can serialize any <code>jfes_value_t</code> to string with one line (actually, three lines, but two of them are for help): </p><div class="fragment"><div class="line">char dump[1024];</div>
<div class="line">jfes_size_t dump_size = 1024;</div>
<div class="line">jfes_value_to_string(&amp;value, beauty_dump, &amp;dump_size, 1);</div>
<div class="line">beauty_dump[dump_size] = &#39;\0&#39;;  /* If you need null-terminated string. */</div>
</div><!-- fragment --><p><code>dump_size</code> will store the dump size. If you pass the fourth argument as 1, the dump will be beautified. And if 0, the dump will be ugly.</p>
<h1><a class="anchor" id="autotoc_md472"></a>
Examples</h1>
<p>You can find examples <a href="https://github.com/NeonMercury/jfes/tree/master/examples">here</a>.</p>
<h1><a class="anchor" id="autotoc_md473"></a>
Licence</h1>
<p><b>The MIT License (MIT)</b> <br  />
 <a href="https://github.com/NeonMercury/jfes/blob/master/LICENSE">See full text.</a> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
